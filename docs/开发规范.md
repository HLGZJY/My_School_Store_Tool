# 校园信息聚合小程序 - 开发规范

> 本文档定义了项目开发过程中必须遵循的规范，包括代码规范、文档规范和开发流程。

---

## 一、开发留痕规范

### 1.1 留痕时机

**每次进行一个新功能模块的开发时**，在开发完成后，必须在 `docs/留痕/` 目录下创建开发概要简介。

### 1.2 留痕文件命名规则

```
[功能名称]开发记录.md
```

示例：
- `登录功能开发记录.md`
- `角色选择开发记录.md`
- `首页功能开发记录.md`

### 1.3 留痕文件模板

每个留痕文件必须包含以下内容：

```markdown
# [功能名称]开发记录

## 开发时间
YYYY-MM-DD

---

## 一、功能概述

[简要描述实现了什么功能]

---

## 二、实现描述

1. **[模块1]**：`文件路径`
   - 实现细节1
   - 实现细节2

2. **[模块2]**：`文件路径`
   - 实现细节1
   - 实现细节2

---

## 三、参数整理

### 3.1 使用的现有参数

| 参数名 | 来源 | 作用范围 |
|-------|------|---------|
| `param1` | 来源 | 作用说明 |

### 3.2 新增参数

| 参数名 | 所在文件 | 作用范围 |
|-------|---------|---------|
| `param1` | 文件路径 | 作用说明 |

### 3.3 环境变量

| 变量名 | 配置位置 | 作用 |
|-------|---------|------|
| `VAR_NAME` | 云开发控制台 | 变量作用 |

---

## 四、注意事项

1. **限制条件**：说明该功能的限制
2. **依赖关系**：说明该功能依赖的其他模块
3. **已知问题**：说明已知的缺陷或待改进点

---

## 五、下一步待办

- [ ] 待办事项1
- [ ] 待办事项2
```

### 1.4 留痕内容要求

| 章节 | 必须包含 | 说明 |
|-----|---------|------|
| **功能概述** | ✅ | 用1-2句话概括功能 |
| **实现描述** | ✅ | 列出涉及的文件和核心实现 |
| **参数整理** | ✅ | 区分现有参数和新增参数 |
| **注意事项** | ✅ | 包含限制、依赖、已知问题 |
| **下一步待办** | ✅ | 标记未完成的测试/部署任务 |

---

## 二、云函数开发规范

### 2.1 必须文件

每个云函数目录必须包含：

| 文件 | 说明 | 是否必须 |
|-----|------|---------|
| `index.js` | 云函数主逻辑 | ✅ 必须 |
| `package.json` | 依赖配置 | ✅ 必须 |
| `cloudfunction.json` | 定时触发配置 | ⏸️ 仅定时任务需要 |

### 2.2 package.json 模板

```json
{
  "name": "云函数名称",
  "version": "1.0.0",
  "description": "功能描述",
  "main": "index.js",
  "dependencies": {}
}
```

### 2.3 错误码规范

| 错误码范围 | 说明 |
|-----------|------|
| 1000-1999 | 系统错误 |
| 2000-2999 | 微信相关错误 |
| 3000-3999 | 文章相关错误 |
| 4000-4999 | 数据源相关错误 |

---

## 三、个人备案限制规范

### 3.1 允许的功能

| 功能 | 说明 |
|-----|------|
| 微信登录 | ✅ 支持 |
| 微信分享 | ✅ 支持 |
| 云开发 | ✅ 支持 |
| 收藏功能 | ✅ 支持 |
| 阅读历史 | ✅ 支持 |

### 3.2 禁止的功能

| 功能 | 替代方案 |
|-----|---------|
| 模板消息推送 | 提供"消息"页面主动查看 |
| 手机号登录 | 仅使用微信登录 |
| 邮箱登录 | 仅使用微信登录 |
| 支付功能 | 不实现 |

### 3.3 代码审查要点

在开发过程中，必须检查以下内容：

- [ ] 代码中不包含手机号相关逻辑
- [ ] 代码中不包含邮箱相关逻辑
- [ ] 代码中不包含支付相关逻辑
- [ ] 页面中不出现手机号/邮箱登录入口
- [ ] 用户协议中说明仅支持微信登录

---

## 四、代码风格规范

### 4.1 命名规范

| 类型 | 规范 | 示例 |
|-----|------|------|
| 文件名 | kebab-case | `article-card.vue` |
| 组件名 | PascalCase | `ArticleCard` |
| 变量名 | camelCase | `articleCount` |
| 常量名 | UPPER_SNAKE_CASE | `API_BASE_URL` |
| 云函数名 | kebab-case | `login`、`getArticles` |

### 4.2 注释规范

```javascript
/**
 * 函数简要描述
 * @param {Type} paramName - 参数说明
 * @returns {Type} 返回值说明
 */
async function functionName(paramName) {
    // 单行注释
}
```

---

## 五、Git提交规范

| 类型 | 说明 |
|-----|------|
| feat | 新功能 |
| fix | 修复bug |
| docs | 文档更新 |
| style | 代码格式调整 |
| refactor | 重构 |
| test | 测试相关 |
| chore | 构建/工具链相关 |

---

## 六、版本记录

| 版本 | 日期 | 说明 |
|-----|------|------|
| v1.0 | 2024-02-10 | 初始版本 |
