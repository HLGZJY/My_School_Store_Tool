# 我的页面开发记录

## 开发信息

| 项目 | 内容 |
|-----|------|
| 日期 | 2026-02-11 |
| 开发者 | Claude |
| 功能 | 我的页面（个人中心） |

## 文件结构

```
pages/mine/
├── mine.vue              # 主页面（105行）
└── components/
    ├── UserCard.vue      # 用户信息卡片（66行）
    ├── StatsCard.vue     # 统计卡片（46行）
    └── MenuList.vue      # 菜单列表（59行）
```

## 组件设计

### UserCard 用户卡片
| 属性 | 类型 | 默认值 | 说明 |
|-----|------|-------|------|
| avatar | String | '/static/logo.png' | 头像URL |
| nickname | String | '未登录' | 用户昵称 |
| role | String | '' | 角色标识 |

| 事件 | 参数 | 说明 |
|-----|------|------|
| switchRole | - | 点击切换身份 |

### StatsCard 统计卡片
| 属性 | 类型 | 默认值 | 说明 |
|-----|------|-------|------|
| collectCount | Number | 0 | 收藏数量 |
| readCount | Number | 0 | 阅读数量 |

| 事件 | 参数 | 说明 |
|-----|------|------|
| click | 'collect' \| 'read' | 点击跳转 |

### MenuList 菜单列表
| 属性 | 类型 | 默认值 | 说明 |
|-----|------|-------|------|
| unreadCount | Number | 0 | 未读消息数 |

| 事件 | 参数 | 说明 |
|-----|------|------|
| click | 'subscribe' \| 'message' \| 'settings' | 点击菜单项 |

## 云函数

| 云函数 | 功能 | 数据表 |
|-------|------|--------|
| getUserInfo | 获取用户信息 | users, collections, readHistory |
| getMessages | 获取消息列表 | messages |

## 健壮性设计

### 1. 空值处理
```javascript
// 头像默认图
:src="avatar || '/static/logo.png'"

// 昵称默认
nickname || '未登录'

// 角色名称映射
const map = { student: '学生', teacher: '教师', admin: '行政人员' };
```

### 2. 未登录状态
```javascript
const openid = this.$store.state.user.userId || uni.getStorageSync('userId');
if (!openid) return; // 不调用云函数
```

### 3. 页面路由映射
```javascript
const PAGE_MAP = {
    collect: '/pages/collection/collection',
    read: '/pages/history/history',
    // ...
};
goToPage(name) {
    const url = PAGE_MAP[name];
    if (url) uni.navigateTo({ url });
}
```

## 测试情况

| 测试项 | 状态 | 说明 |
|-------|------|------|
| 用户信息显示 | ⏳ 待测试 | 需部署 getUserInfo |
| 统计数字加载 | ⏳ 待测试 | 收藏数、阅读数 |
| 未读消息红点 | ⏳ 待测试 | 需部署 getMessages |
| 页面跳转 | ⏳ 待测试 | 收藏/历史/订阅/消息/设置 |

## 待完善

- [x] 我的页面主框架 ✅
- [x] UserCard 组件 ✅
- [x] StatsCard 组件 ✅
- [x] MenuList 组件 ✅
- [x] getUserInfo 云函数 ✅
- [x] getMessages 云函数 ✅
- [ ] 测试真实数据

## 修复记录

| 日期 | 问题 | 修复方案 |
|-----|------|---------|
| 2026-02-11 | 代码冗长311行 | 拆分为4个文件，每个<100行 |
| 2026-02-11 | 健壮性不足 | 添加空值检查、默认图片、默认文字 |
