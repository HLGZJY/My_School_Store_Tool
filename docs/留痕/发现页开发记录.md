# 发现页开发记录

## 开发信息

| 项目 | 内容 |
|-----|------|
| 日期 | 2026-02-11 |
| 开发者 | Claude |
| 功能 | 发现页 |

## 文件结构

```
pages/discover/
├── discover.vue              # 主页面（231行）
└── components/
    ├── HotRanking.vue        # 热门排行（117行）
    ├── TagCloud.vue          # 标签云（82行）
    ├── Timeline.vue          # 时间轴（135行）
    └── SubscribeManager.vue  # 订阅管理（125行）
```

## 组件设计

### HotRanking 热门排行
- 接收 `ranking` prop
- 发射 `more`（查看更多）、`detail`（点击详情）事件
- 支持 Top 3 金银铜样式

### TagCloud 标签云
- 接收 `tags` prop
- 字号随使用频率变化（14px - 18px）
- 发射 `search` 事件

### Timeline 时间轴
- 接收 `timeline` prop
- 点击展开/收起
- 懒加载文章列表
- 发射 `toggle`、`detail` 事件

### SubscribeManager 订阅管理
- 接收 `subscribed`、`recommended` props
- 支持订阅/取消订阅
- 发射 `subscribe`、`unsubscribe`、`more` 事件

## 云函数

| 云函数 | 功能 | 数据表 |
|-------|------|--------|
| getHotArticles | 获取热门排行（7天） | articles |
| getTagCloud | 获取标签云 | articles |
| getTimeline | 获取时间轴 | articles |

## 数据库集成

| 云函数 | 数据表 | 说明 |
|-------|--------|------|
| getHotArticles | articles | 按7天浏览量排序 |
| getTagCloud | articles | 聚合统计标签 |
| getTimeline | articles | 按日期分组 |

## 测试情况

| 测试项 | 状态 | 说明 |
|-------|------|------|
| 热门排行渲染 | ✅ 通过 | 前端渲染正常 |
| 标签云渲染 | ✅ 通过 | 字号动态计算正常 |
| 时间轴展开 | ✅ 通过 | 点击展开/收起正常 |
| 订阅/取消订阅 | ✅ 通过 | 本地存储正常 |
| 详情跳转 | ✅ 通过 | 跳转到 detail 页 |
| 真实数据测试 | ✅ 通过 | 对接 articles 表 |

## 修复记录

| 日期 | 问题 | 修复方案 |
|-----|------|---------|
| 2024-02-11 | 模拟数据改为真实数据库查询 | 使用 uniCloud.database() |
| 2026-02-11 | 热门排行、时间轴无数据显示 | 移除7天时间限制（测试数据均为旧文章） |
| 2026-02-11 | getTagCloud统计异常 | 修复从 tags.role 字段提取标签 |

## 待完善

- [x] 云数据库集成 ✅
- [ ] 订阅管理页面
- [ ] 搜索统计功能
