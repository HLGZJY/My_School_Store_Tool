# 开发留痕 - 2026-02-13

## 本次开发内容

### 1. 管理员功能架构

#### 数据库
- 新建 `admins` 管理员表
  - 路径：`uniCloud-aliyun/database/schemas/admins.schema.json`
  - 字段：openid, nickname, avatar, permissions, status

#### 登录逻辑修改
- 修改 `login` 云函数，同时查询 users 和 admins 表
- 返回 `needSelect` 字段，前端据此弹出选择框
- 支持 `entryType: 'admin' | 'user'`

#### 前端
- 修改 `store/modules/user.js` - 新增 entryType 状态
- 修改 `pages/login/login.vue` - 处理选择逻辑

---

### 2. 管理端页面

| 页面 | 路径 | 功能 |
|------|------|------|
| 仪表盘 | pages/admin/dashboard.vue | 统计、采集入口 |
| 文章审核 | pages/admin/review.vue | 审核文章 |
| 数据源管理 | pages/admin/sources.vue | CRUD数据源 |
| 用户管理 | pages/admin/users.vue | 查看用户、设管理员 |

---

### 3. 云函数

| 云函数 | 路径 | 功能 |
|--------|------|------|
| adminStats | cloudfunctions/adminStats/ | 统计数据 |
| addAdmin | cloudfunctions/addAdmin/ | 添加管理员 |
| syncSource | cloudfunctions/syncSource/ | 数据采集 |
| approveArticle | cloudfunctions/approveArticle/ | 文章审核 |
| manageSources | cloudfunctions/manageSources/ | 数据源管理 |
| manageUsers | cloudfunctions/manageUsers/ | 用户管理 |
| adminGetArticles | cloudfunctions/adminGetArticles/ | 文章列表(审核用) |

---

### 4. 待测试功能

- [ ] 登录选择入口（需同时是 users 和 admins 表的用户）
- [ ] 管理端 dashboard 统计数据
- [ ] 文章审核功能
- [ ] 数据源 CRUD
- [ ] 用户管理
- [ ] 数据采集（需配置 Moonshot API Key）

---

### 5. 配置项

`syncSource/index.js` 中需要配置：
```javascript
const MOONSHOT_API_KEY = process.env.MOONSHOT_API_KEY || 'your-api-key-here';
```

---

### 6. 测试账号

已在 admins 表添加测试管理员：
- openid: `oO7at7byb0mS_uK8aZw_TNNOUD48`
- nickname: 测试管理员
