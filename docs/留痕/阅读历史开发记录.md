# 阅读历史开发记录

## 开发信息

| 项目 | 内容 |
|-----|------|
| 日期 | 2026-02-11 |
| 开发者 | Claude |
| 功能 | 阅读历史记录与展示 |

## 文件结构

```
pages/history/
└── history.vue           # 阅读历史页面

cloudfunctions/
├── recordRead/           # 记录阅读
└── getReadingHistory/    # 获取阅读历史
└── clearReadingHistory/   # 清空阅读历史

database/schemas/
└── readHistory.schema.json
```

## 云函数

### recordRead
| 参数 | 类型 | 说明 |
|-----|------|------|
| userId | String | 用户openid |
| articleId | String | 文章ID |
| duration | Number | 阅读时长（秒） |

**功能**：
- 检查是否已存在阅读记录
- 存在则更新时间
- 不存在则新增记录
- 更新用户阅读计数

### getReadingHistory
| 参数 | 类型 | 说明 |
|-----|------|------|
| userId | String | 用户openid |
| page | Number | 页码 |
| pageSize | Number | 每页数量 |

### clearReadingHistory
| 参数 | 类型 | 说明 |
|-----|------|------|
| userId | String | 用户openid |

**功能**：
- 删除用户所有阅读历史
- 重置用户阅读计数为0

## 阅读历史表结构

```json
{
  "_id": "记录ID",
  "openid": "用户OpenID",
  "articleId": "文章ID",
  "article": {
    "title": "标题",
    "sourceName": "来源",
    "publishTime": 发布时间
  },
  "readTime": 阅读时间,
  "duration": 阅读时长（秒）
}
```

## 页面功能

### 阅读历史页面 (history.vue)
| 功能 | 说明 |
|-----|------|
| 列表展示 | 显示标题、来源、阅读时间、时长 |
| 下拉刷新 | 重新加载数据 |
| 上拉加载更多 | 分页加载 |
| 清空历史 | 确认后清空所有记录 |
| 点击跳转 | 跳转到文章详情 |

### 格式显示
```javascript
// 时间格式
formatTime(timestamp) {
  if (hours < 1) return '刚刚'
  if (hours < 24) return `${hours}小时前`
  if (hours < 48) return '昨天'
  return `${month}月${date}日`
}

// 时长格式
formatDuration(seconds) {
  if (!seconds) return '0秒'
  if (seconds < 60) return `${seconds}秒`
  return `${Math.floor(seconds / 60)}分钟`
}
```

## 测试情况

| 测试项 | 状态 | 说明 |
|-------|------|------|
| 详情页自动记录阅读 | ⏳ 待测试 |
| 阅读历史列表展示 | ⏳ 待测试 |
| 阅读时长统计 | ⏳ 待测试 |
| 清空历史功能 | ⏳ 待测试 |
| 分页加载 | ⏳ 待测试 |
